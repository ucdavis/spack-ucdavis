packages:

  ####
  # Externals: non-buildable
  ####

  mariadb:
    externals:
    - spec: mariadb@10.8.2 %gcc
      prefix: /usr
    buildable: false

  munge:
    externals:
    - spec: munge@0.5.14 %gcc
      prefix: /usr
    buildable: false

  ####
  # Externals: buildable
  ####


  mariadb-c-client:
    externals:
    - spec: mariadb-c-client@3 %gcc
      prefix: /usr

  ####
  #
  # Core stack and libraries
  #
  ####
  #

  nvhpc:
    require: '+blas +lapack +mpi'

  rust:
    require: '+dev'
      
  slurm:
    require: '+pmix +mariadb +hwloc +restd +nvml +cgroup +pam sysconfdir=/etc/slurm'

  ucx:
    require: '+thread_multiple'
  
  openmpi:
    require: 'fabrics=ucx schedulers=slurm +legacylaunchers +cuda cuda_arch=75,86'

  environment-modules:
    variants: etcdir=/etc/environment-modules

  # When mpi=openmpi, this introduces an unresolvable dependency.
  # See https://github.com/spack/spack/issues/15836 for details
  hwloc:
    require: '~netloc +pci +libxml2 +libudev +nvml +cuda +cairo cuda_arch=75,86'

  mkl:
    require: intel-oneapi-mkl

  mpi:
    require: openmpi

  ####
  #
  # Other package / build tree constraints
  #
  ####

  cairo:
    require: +X +ft +fc +pdf +png +gobject

  dbus:
    require: '@1.13.6 system-socket=/var/run/dbus/system_bus_socket'

  gettext:
    require: +libxml2

  #gdal:
  #  variants: +netcdf +sqlite3 +xml2 +grib +hdf5 +curl +geos +cfitsio +crypto +expat +gif +jasper +pcre +png +zstd

  #gdl:
  #  version: [0.9.9]
  #  variants: +graphicsmagick +python

  #libxml2:
  #  require: +python
  #require: '@2.10.2: +python'

  #python:
  #require: ~libxml2

  sqlite:
    variants: +rtree

  tbb:
    require: intel-oneapi-tbb

  # xmlto does not build properly with OneAPI
  xmlto:
    require: "%gcc"

  squashfs:
    variants: +gzip +lz4 +lzo +xz +zstd

  ####

  all:
    target: [x86_64_v3]
    compiler:
    - gcc @11.4.0
    providers:
      tbb:
      - intel-oneapi-tbb
      fftw-api:
      - fftw
    variants:
    - cuda_arch=75

