spack:
  definitions:
    - relion-cuda:
      - relion @5.0-beta +gui +cuda cuda_arch=75 purpose=cluster torch_home=/share/databases/relion/torch conda_python=/share/apps/conda/environments/relion-5.0/bin/python
      - relion @4.0.1 +gui +cuda cuda_arch=75 purpose=cluster 
      - relion @3.1.3 +gui +cuda cuda_arch=75 purpose=cluster
    - relion-cpu:
      - relion @5.0-beta +gui ~cuda +altcpu purpose=cluster torch_home=/share/databases/relion/torch conda_python=/share/apps/conda/environments/relion-5.0/bin/python
      - relion @4.0.1 +gui ~cuda +altcpu purpose=cluster
      - relion @3.1.3 +gui ~cuda +altcpu purpose=cluster
      # Cryo-EM
    - gctf
    - motioncor2 @1.5.0
    - ghostscript
    - ctffind+openmp %oneapi target=skylake_avx512 ^intel-oneapi-mkl
    - ctffind+openmp %gcc target=zen2 ^amdfftw target=zen2

    # Ongoing issue with OneAPI and CUDA: https://github.com/spack/spack/issues/40374
    - matrix:
      - [$relion-cuda]
      - ['%gcc@11.4.0 target=zen2 ^cuda@11.7.1+allow-unsupported-compilers ^amdfftw target=zen2 ^ctffind+openmp target=zen2',
         '%gcc@11.4.0 +mklfft +gpu_delay target=skylake_avx512 ^cuda@11.7.1+allow-unsupported-compilers ^intel-oneapi-mkl ^ctffind+openmp^intel-oneapi-mkl']

    - matrix:
      - [$relion-cpu]
      - ['%gcc@11.4.0 target=zen2 ^amdfftw target=zen2']

    - relion-bbr @3.1.2 %gcc@7.5.0 +gui +cuda +mklfft cuda_arch=75 purpose=cluster target=skylake_avx512
      ^intel-oneapi-mkl ^ctffind+openmp^intel-oneapi-mkl ^cuda@11.2.2+allow-unsupported-compilers
    - py-relion-helper @0.3
    - unblur@1.0.2 target=x86_64_v3 ^cuda@11.7.1
    #- cistem@1.0.0-beta target=x86_64_v3 ^cuda@11.7.1
