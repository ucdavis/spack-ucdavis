spack:
  definitions:
    - core_specs: &core_specs
      - aocc @3.2.0 +license-agreed
      - openmpi @4.1.5 ~romio
      - openmpi @4.1.5 +romio
      - slurm @23-02-6
      - hwloc @2.9.3
      - libevent @2.1.12
      - pmix @4.2.6
      - ucx @1.14.1
      - cuda @11.7
      - gcc @11.3.0
      - gcc @9.5.0 %gcc@11.3.0
      - gcc @7.5.0 %gcc@11.3.0
      #- gcc@5.5.0 %gcc@9.5.0
      #- gcc@4.9.4 %gcc@9.5.0
      - go @1.20.3
      - intel-oneapi-compilers @2022.2.1
      #- nvhpc@23.1 # huge, waiting...
      - jdk @17.0.1
      - numactl @2.0.14
      - openjdk @16.0.2
      - openjdk @11.0.17_8
      #- julia@1.8.5
      #- julia@1.9.0
    - libs_specs: &libs_specs
      - amdfftw @3.2 target=zen2
      - blas @0.4.3
      - boost @1.82
      - bzip2 @1.0.8 +shared
      - ccfits @2.6
      - cfitsio @4.2.0
      - cgal @5.4.1
      - dealii @9.4.2 ^openmpi+romio
      - eigen @3.4.0
      - fftw @3.3.10
      - fsl @6.0.5
      - gmp @6.2.1
      - gsl @2.7.1
      - hdf5 @1.14.1-2
      - intel-oneapi-mkl @2022.2.1
      - intel-oneapi-tbb @2021.9.0
      - librsvg @2.51.0
      - libsvm @323
      - libszip @2.1.1
      - libxc @6.1.0
      - mpfr
      - nlopt @2.7.0
      - netcdf-c @4.9.2
      - netcdf-cxx4 @4.3.1
      - netcdf-fortran @4.6.0
      - netlib-lapack @3.11.0
      - netlib-xblas @1.0.248
      - nlohmann-json @3.11.2
      - ntirpc @3.2
      - openblas @0.3.23
      - parmetis @4.0.3
      - plumed @2.8.2
      - spglib @2.0.2
      - voropp @0.4.6
      - xerces-c @3.2.4
      - yaml-cpp
      - zlib @1.2.13
    - general_specs: &general_specs
      # misc
      - abinit @9.8.3
      - amber @20
      - apptainer @1.1.9
      - aria2
      - aspera-cli
      - atlas @3.10.3
      - awscli 
      - cdo
      - cp2k @2023.1
      - cplex @12.8.0
      - cmake
      - doxygen @1.9.6
      - elk @8.3.22
      - exciting @oxygen +mpi
      - feh @3.10
      - fplo @22.00-62
      - freesurfer @7.2.0
      - gaussian @16-B.01
      - geant4 @11.1.1
      - genie @3.0.6
      - gmt @6.2.0
      - gnuplot @5.4.3
      - gromacs @2019.6
      - gromacs @2023.1
      - hypre
      - idl @8.7.3
      - imagemagick @7.0.8-7
      - jags
      - lammps @20230208
      - lcov @1.16
      - matlab @R2023a
      - mark
      - nco
      - nwchem @7.2.0
      - octave @8.2.0
      - octopus @7.3 ^fftw
      #- octopus @12.2
      #- orca @5.0.3-f.1
      - parallel
      - paraview @5.11.1
      - pigz
      - planck-likelihood @2.00
      - pythia6 @6.4.28
      - pythia8 @8.309
      - quantum-espresso @7.1
      - rclone
      - root @6.28.04 +pythia6 +pythia8 +python +fortran +fftw
      - rstudio @2022.12.0+server ^curl@7.85.0
      - stata
      - shengbte @1.1.1-8a63749 %gcc@7.5.0
      - trilinos @13.0.1 # +cuda +uvm +wrapper
      - turbovnc
      - valgrind @3.20.0
      - virtualgl
      - yasm

      # genomics
      - abyss
      #- allpaths-lg %gcc@4.9.4
      - angsd
      - aragorn
      - augustus
      - bayenv2
      - bbmap
      - bcftools +libgsl +perl-filters
      - beagle
      - bedops
      - bedtools2
      - blast-plus @2.13.0
      - blast2go
      - blat
      - bowtie
      - bowtie2
      - braker
      - busco
      - bwa
      - bwa-mem2 @2.2.1 %oneapi target=x86_64
      - bwtool
      - canu
      - cap3
      - cdhit
      - circos
      - clustal-omega
      - clustalw
      - coverm %gcc@11.3.0 ^bwa-mem2%oneapi ^minimap2@2.26
      - corset
      - cufflinks
      - dashing @0.4.0 %gcc@7.5.0 # used by coverm
      - dashing @1.0.3
      - deml
      - diamond
      - dssp
      - ea-utils
      - emboss @6.6.0
      - exonerate
      - exonerate-gff3
      - fastani @1.33
      - fastme
      - fastq-screen
      - fastqc
      - fasttree
      - fastx-toolkit
      - freebayes
      - gatk@3.8.1
      - gatk@4.2.6.1 %gcc@11.3.0
      - gemma
      - genometools
      - genrich
      - gffcompare
      - gffread
      - glimmer
      - hisat2
      - hh-suite
      - hmmer
      - homer
      - htslib
      - igv
      - infernal
      - interproscan
      - iq-tree
      - iqtree2
      - jellyfish @1.1.11
      - jellyfish @2.3.0
      - kaiju @1.6.2
      - kalign
      - kallisto
      - kmergenie
      - kraken
      - kraken2
      - krakenuniq
      - last
      - mafft
      - maker
      - mash
      - masurca
      - maven
      - mcl
      - meme @5.3.0
      - megahit @1.1.4 %gcc@7.5.0
      - metabat @2.15
      - metaeuk
      - minced
      - miniasm
      - minimap2 @2.26
      - mirdeep2
      - mmseqs2
      - mothur
      - mummer
      - mummer4
      - muscle
      - muscle5
      - ncbi-rmblastn
      - ncbi-toolkit
      - ncbi-vdb
      - nextflow
      - ngsadmix
      - ngstools
      - ont-guppy
      - orthofinder
      - orthomcl
      - phylip
      - phyluce
      - picard
      - pilon
      - plink
      - plink-ng
      - pplacer @1.1.alpha19
      - prodigal @2.6.3
      - prokka
      - py-biopython
      - py-checkm-genome
      - py-cutadapt
      - py-deeptools
      - py-htseq
      - py-ipython
      - py-metaphlan @4.0.2
      - py-multiqc
      - py-quast @4.6.3
      - py-vcf-kit
      - qualimap
      - raxml
      - raxml-ng
      - ray
      - recon
      - repeatmasker
      - repeatmodeler ^repeatmasker@4.0.9
      - repeatscout
      - rnaquast
      - rsem
      - sabre
      - salmon @1.9.0
      - salmon @1.10.1
      - samtools @1.16.1
      - satsuma2
      - scallop
      - seqprep
      - seqtk
      - shoremap %gcc@11.3.0
      - sickle
      - slim
      - smartdenovo
      - snap-korf
      - sortmerna
      - spades
      - sratoolkit
      - star
      #- strelka
      - stringtie
      - subread @2.0.2
      - tabix
      - tassel
      - tophat @2.1.2
      - trimgalore
      - trimmomatic
      - trinity
      - usearch @11.0.667
      - vcftools
      - velvet
      - velvetoptimiser
      - vsearch

  specs:
  - environment-modules@5.2.0
  - $core_specs
  - $libs_specs
  - $general_specs

  view:
    generic:
      root: /share/apps/22.04/spack/environments/main/view
      select:
      - environment-modules
      exclude:
      - gcc
      link_type: symlink

  modules:
    common:
      tcl: &tcl_common_opts
        verbose: true
        hash_length: 0
        exclude_implicits: true
        all:
          template: hpccf/default.tcl
          autoload: none
          prerequisites: none
          conflict:
          - '{name}'
          environment:
            set:
              '{name}_ROOT': '{prefix}'
        ^python:
          autoload: direct
          prerequisites: direct

    default:
      roots:
        tcl: $spack/../../modulefiles/spack/tcl/
      prefix_inspections:
        include:
        - CPATH
        - C_INCLUDE_PATH
        - CPLUS_INCLUDE_PATH
        lib64:
        - LD_LIBRARY_PATH
        - LIBRARY_PATH
        lib:
        - LD_LIBRARY_PATH
        - LIBRARY_PATH
      arch_folder: false
      tcl:
        <<: *tcl_common_opts
        defaults:
        - openmpi~romio
        projections:
          all: '{name}/{version}'
          target=zen2: '{name}/{version}+amd'
          slurm: slurm/23.02.6
          openmpi~romio: openmpi/{version}
          openmpi+romio: openmpi/{version}-mpi-io
        gcc@9.5:
          template: hpccf/gcc.tcl
        slurm:
          template: hpccf/slurm.tcl
        apptainer:
          load:
          - squashfs
    core:
      roots:
        tcl: $spack/../../modulefiles/spack/core/
      prefix_inspections:
        include:
        - CPATH
        - C_INCLUDE_PATH
        - CPLUS_INCLUDE_PATH
        lib64:
        - LD_LIBRARY_PATH
        - LIBRARY_PATH
        lib:
        - LD_LIBRARY_PATH
        - LIBRARY_PATH
      arch_folder: false
      tcl:
        <<: *tcl_common_opts
        include: *core_specs
        exclude: ['@:']
        defaults:
        - openmpi~romio
        projections:
          all: '{name}/{version}'
          target=zen2: '{name}/{version}+amd'
          slurm: slurm/23.02.6
          openmpi~romio: openmpi/{version}
          openmpi+romio: openmpi/{version}-mpi-io
        gcc@9.5:
          template: hpccf/gcc.tcl
        slurm:
          template: hpccf/slurm.tcl

    libs:
      roots:
        tcl: $spack/../../modulefiles/spack/libs/
      prefix_inspections:
        include:
        - CPATH
        - C_INCLUDE_PATH
        - CPLUS_INCLUDE_PATH
        lib64:
        - LD_LIBRARY_PATH
        - LIBRARY_PATH
        lib:
        - LD_LIBRARY_PATH
        - LIBRARY_PATH
      arch_folder: false
      tcl:
        <<: *tcl_common_opts
        include: *libs_specs
        exclude: ['@:']
        projections:
          all: '{name}/{version}'
          target=zen2: '{name}/{version}+amd'

    general:
      roots:
        tcl: $spack/../../modulefiles/spack/general/
      arch_folder: false
      tcl:
        <<: *tcl_common_opts
        include: *general_specs
        exclude: ['@:']
        projections:
          all: '{name}/{version}'
          target=zen2: '{name}/{version}+amd'
          rstudio: rstudio-server/{version}
        circos:
          template: hpccf/circos-version-warning.tcl
        rstudio:
          template: hpccf/farm/rstudio-server.tcl
        turbovnc:
          template: hpccf/farm/turbovnc.tcl

  concretizer:
    unify: false
